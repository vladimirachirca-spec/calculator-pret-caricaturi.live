<!doctype html>
<html lang="ro">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Calculator preț – caricaturi.live</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin: 0; background:#f6f6f6; }
    .wrap { max-width: 860px; margin: 24px auto; padding: 16px; }
    .card { background: #fff; border: 1px solid #e6e6e6; border-radius: 14px; padding: 16px; box-shadow: 0 6px 18px rgba(0,0,0,.06); }
    h1 { font-size: 20px; margin: 0 0 6px; }
    .muted { color:#666; margin: 0 0 14px; line-height: 1.35; }
    .grid { display:grid; grid-template-columns: 1fr 1fr; gap: 12px; }
    label { display:block; font-weight: 650; margin-bottom: 6px; }
    select, input[type="number"] { width:100%; padding: 10px 12px; border:1px solid #ddd; border-radius: 12px; font-size: 16px; background: #fff; }
    .row { margin-top: 12px; }
    .checks { display:flex; flex-wrap: wrap; gap: 10px 18px; align-items:center; }
    .checks label { font-weight: 500; margin:0; display:flex; gap:8px; align-items:center; }
    .pill { display:inline-block; padding: 2px 10px; border:1px solid #eee; border-radius: 999px; background:#fafafa; font-size: 13px; color:#444; }
    .total { font-size: 36px; font-weight: 850; letter-spacing: -0.5px; }
    .break { color:#333; line-height: 1.35; margin-top: 8px; font-size: 14px; }
    .warn { background:#fff3cd; border:1px solid #ffeeba; color:#6b5200; padding:10px 12px; border-radius: 12px; margin-top: 12px; display:none; }
    .actions { display:flex; gap:10px; flex-wrap: wrap; margin-top: 14px; }
    button { border: 1px solid #ddd; background:#fff; padding: 10px 12px; border-radius: 12px; cursor:pointer; font-weight:650; }
    button.primary { background:#111; color:#fff; border-color:#111; }
    .footer { margin-top: 10px; font-size: 12px; color:#666; }
    @media (max-width: 720px){ .grid { grid-template-columns: 1fr; } }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>Calculator preț – caricatură / portret după fotografie</h1>
      <p class="muted">
        Prețul se calculează instant, în funcție de opțiuni. Tipul (caricatură/portret) nu influențează prețul.
      </p>

      <div class="grid">
        <div>
          <label for="tip">Tip lucrare</label>
          <select id="tip">
            <option value="caricatura">caricatură</option>
            <option value="portret">portret</option>
          </select>
        </div>

        <div>
          <label for="culoare">Alb-negru sau color?</label>
          <select id="culoare">
            <option value="bw">alb/negru</option>
            <option value="color">color</option>
          </select>
        </div>

        <div>
          <label for="format">Format / dimensiune</label>
          <select id="format">
            <option value="A4">A4 (max 1 persoană)</option>
            <option value="A3">A3 (max 3 persoane)</option>
            <option value="A2">A2 (max 6 persoane)</option>
            <option value="A1">A1 (max 10 persoane)</option>
          </select>
          <div class="footer">Formatul impune doar limita de persoane; prețul crește din cauza numărului de personaje.</div>
        </div>

        <div>
          <label for="pers">Număr persoane</label>
          <input id="pers" type="number" min="1" step="1" inputmode="numeric" value="1" />
          <div class="footer">Persoane extra: +75% din prețul primei persoane / persoană.</div>
        </div>
      </div>

      <div class="row">
        <div class="checks">
          <label><input id="detaliat" type="checkbox" /> Detaliat (+50% din baza culorii)</label>
          <label><input id="rama" type="checkbox" /> Ramă (în funcție de format)</label>
          <span id="maxpill" class="pill"></span>
        </div>
      </div>

      <div class="row" id="techRow">
        <label for="tech">Tehnică (doar pentru color)</label>
        <select id="tech">
          <option value="digital">digital (+0)</option>
          <option value="acuarela">acuarelă (+50)</option>
          <option value="pastel">pastel (+75)</option>
          <option value="ulei">ulei pe pânză (+300)</option>
        </select>
        <div class="footer">Tehnica se aplică la prima persoană; persoanele extra sunt 75% din prețul primei persoane.</div>
      </div>

      <div id="warn" class="warn"></div>

      <div class="row" style="margin-top:18px">
        <div class="muted" style="margin:0 0 4px">Total estimativ</div>
        <div class="total" id="total">—</div>
        <div class="break" id="breakdown"></div>

        <div class="actions">
          <button id="reset">Resetează</button>
          <button class="primary" id="copy">Copiază rezumat</button>
        </div>
      </div>
    </div>
  </div>

<script>
(() => {
  const BASE = { bw: 100, color: 200 };
  const DETAIL_MULT = 0.50;
  const EXTRA_MULT = 0.75;
  const MAX_BY_FORMAT = { A4: 1, A3: 3, A2: 6, A1: 10 };
  const FRAME_BY_FORMAT = { A4: 25, A3: 50, A2: 100, A1: 200 };
  const TECH_ADD = { digital: 0, acuarela: 50, pastel: 75, ulei: 300 };

  const el = (id) => document.getElementById(id);

  const tip = el("tip");
  const culoare = el("culoare");
  const format = el("format");
  const pers = el("pers");
  const detaliat = el("detaliat");
  const rama = el("rama");
  const techRow = el("techRow");
  const tech = el("tech");
  const warn = el("warn");
  const total = el("total");
  const breakdown = el("breakdown");
  const maxpill = el("maxpill");

  const fmtMoney = (n) => `${Math.round(n)} lei`;

  function setMinMaxForPeople() {
    const maxP = MAX_BY_FORMAT[format.value];
    pers.setAttribute("min", "1");
    pers.setAttribute("max", String(maxP));
    maxpill.textContent = `Max persoane format: ${maxP}`;
    return maxP;
  }

  // IMPORTANT: corectăm valoarea doar când userul a terminat (change/blur),
  // nu în timp ce tastează (ca să nu “sară” pe mobil).
  function normalizePeopleValue() {
    const maxP = setMinMaxForPeople();

    const raw = pers.value;
    if (raw === "") {
      // îl lăsăm gol cât tastează; totalul va arăta „—”
      warn.style.display = "none";
      warn.textContent = "";
      return null;
    }

    let n = parseInt(raw, 10);
    if (!Number.isFinite(n) || n < 1) n = 1;
    if (n > maxP) {
      n = maxP;
      warn.style.display = "block";
      warn.textContent = `Formatul ${format.value} permite maximum ${maxP} persoane.`;
    } else {
      warn.style.display = "none";
      warn.textContent = "";
    }

    pers.value = String(n);
    return n;
  }

  function compute(liveTyping = false) {
    const maxP = setMinMaxForPeople();

    // dacă tastează și e gol, nu îl forțăm
    if (liveTyping && pers.value === "") {
      total.textContent = "—";
      breakdown.innerHTML = "• Completează numărul de persoane.";
      return;
    }

    // la calcul normal, încercăm să normalizăm
    const n = liveTyping
      ? (Number.isFinite(parseInt(pers.value, 10)) ? parseInt(pers.value, 10) : null)
      : normalizePeopleValue();

    if (n === null) {
      total.textContent = "—";
      breakdown.innerHTML = "• Completează numărul de persoane.";
      return;
    }

    // dacă userul tastează un număr > max, îl afișăm, dar calculăm ca max (fără să-l rescriem încă)
    const safeN = Math.max(1, Math.min(n, maxP));

    const col = culoare.value;
    const base = BASE[col];

    techRow.style.display = (col === "color") ? "block" : "none";
    const techAdd = (col === "color") ? TECH_ADD[tech.value] : 0;

    const detailAdd = detaliat.checked ? (DETAIL_MULT * base) : 0;

    const firstPerson = base + techAdd + detailAdd;

    const extraCount = Math.max(0, safeN - 1);
    const extraEach = EXTRA_MULT * firstPerson;
    const extras = extraCount * extraEach;

    const frame = rama.checked ? FRAME_BY_FORMAT[format.value] : 0;

    const grand = firstPerson + extras + frame;
    total.textContent = fmtMoney(grand);

    const lines = [];
    lines.push(`Tip lucrare: ${tip.value}`);
    lines.push(`Bază (${col === "bw" ? "alb/negru" : "color"}): ${fmtMoney(base)}`);
    if (col === "color") lines.push(`Tehnică (${tech.options[tech.selectedIndex].text}): +${fmtMoney(techAdd)}`);
    if (detaliat.checked) lines.push(`Detaliat: +${fmtMoney(detailAdd)} (50% din bază)`);
    lines.push(`Prima persoană: ${fmtMoney(firstPerson)}`);
    if (extraCount > 0) lines.push(`Persoane extra: ${extraCount} × ${fmtMoney(extraEach)} = ${fmtMoney(extras)}`);
    else lines.push(`Persoane extra: 0`);
    if (rama.checked) lines.push(`Ramă (${format.value}): +${fmtMoney(frame)}`);

    breakdown.innerHTML = lines.map(s => `• ${s}`).join("<br>");
  }

  function resetAll() {
    tip.value = "caricatura";
    culoare.value = "bw";
    format.value = "A4";
    pers.value = "1";
    detaliat.checked = false;
    rama.checked = false;
    tech.value = "digital";
    warn.style.display = "none";
    warn.textContent = "";
    compute(false);
  }

  function copySummary() {
    const col = culoare.value === "bw" ? "alb/negru" : "color";
    const n = parseInt(pers.value, 10) || 1;
    const techText = (culoare.value === "color") ? tech.options[tech.selectedIndex].text : "creion (alb/negru)";
    const msg =
`Estimare comandă:
- Tip: ${tip.value}
- Culoare: ${col}
- Format: ${format.value}
- Persoane: ${n}
- Detaliat: ${detaliat.checked ? "da" : "nu"}
- Tehnică: ${techText}
- Ramă: ${rama.checked ? "da" : "nu"}
=> Total estimativ: ${total.textContent}`;

    navigator.clipboard?.writeText(msg).then(() => {
      const btn = el("copy");
      const old = btn.textContent;
      btn.textContent = "Copiat!";
      setTimeout(() => btn.textContent = old, 900);
    }).catch(() => alert(msg));
  }

  // schimbări de select / checkbox: recalc complet (și normalize people dacă e cazul)
  [tip, culoare, format, detaliat, rama, tech].forEach(x => {
    x.addEventListener("change", () => compute(false));
  });

  // pentru input persoane:
  // - la tastare: calcul live fără să rescrie valoarea (important pt mobil)
  pers.addEventListener("input", () => compute(true));
  // - când user termină (iese din câmp sau confirmă): normalize + calc
  pers.addEventListener("change", () => compute(false));
  pers.addEventListener("blur", () => compute(false));

  el("reset").addEventListener("click", resetAll);
  el("copy").addEventListener("click", copySummary);

  resetAll();
})();
</script>
</body>
</html>
